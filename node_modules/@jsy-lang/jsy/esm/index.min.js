const e=/[?|+*@:.\/\\\(\)\{\}\[\]\=\>]/g,t=/(?:^|[ \t]+)/.source,n=/(?=$|[ \t]+)/.source;function s(s,o){return"string"==typeof s?(s=s.replace(e,"\\$&"),o&&(s=t+s+n),`(?:${s})`):s instanceof RegExp?s.source:void 0}const o={"":e=>({pre:`((${e}) => {`,post:"})"}),">":e=>({pre:`(async (${e}) => {`,post:"})"}),">*":e=>({pre:`((async function * (${e}) {`,post:"}).bind(this))"}),"*":e=>({pre:`((function * (${e}) {`,post:"}).bind(this))"})},i={__proto__:o,"":e=>({pre:`((${e}) =>`,post:")"}),">":e=>({pre:`(async (${e}) =>`,post:")"})},r={"":e=>({pre:`(((${e}) => {`,post:"})())"}),">":e=>({pre:`((async (${e}) => {`,post:"})())"}),">*":e=>({pre:`((async function * (${e}) {`,post:"}).call(this))"}),"*":e=>({pre:`((function * (${e}) {`,post:"}).call(this))"})},c={__proto__:r,"":e=>({pre:`(((${e}) =>`,post:")())"}),">":e=>({pre:`((async (${e}) =>`,post:")())"})},p=e=>function(t){let[n,s]=t.content.match(this.jsy_op),o=e[s||""];if(void 0===o)throw new SyntaxError(`JSY lambda expression unrecognized specifier ("${s}")`);return o("")},l=e=>`{${e}}`,a=e=>`[${e}]`,_=(e,t=(e=>e))=>function(n){let[s,o,i]=n.content.match(this.jsy_op),r=e[i||""];if(void 0===r)throw new SyntaxError(`JSY lambda with args expression unrecognized specifier ("${i}")`);return r(t(o)||"")},h=[{jsy_op0:"@\\:=>",jsy_op:/@\\:(.*?)=>(>?\*?)/,pre:"(()=>",post:")",opResolve:_(i,l)},{jsy_op0:"@\\:::",jsy_op:/@\\:(.*?)::(>?\*?)/,pre:"(()=>{",post:"})",opResolve:_(o,l)},{jsy_op0:"@\\#=>",jsy_op:/@\\#(.*?)=>(>?\*?)/,pre:"(()=>",post:")",opResolve:_(i,a)},{jsy_op0:"@\\#::",jsy_op:/@\\#(.*?)::(>?\*?)/,pre:"(()=>{",post:"})",opResolve:_(o,a)},{jsy_op0:"@\\=>",jsy_op:/@\\(.*?)=>(>?\*?)/,pre:"(()=>",post:")",opResolve:_(i)},{jsy_op0:"@\\::",jsy_op:/@\\(.*?)::(>?\*?)/,pre:"(()=>{",post:"})",opResolve:_(o)},{jsy_op0:"@=>",jsy_op:/@=>(>?\*?)/,pre:"(()=>",post:")",opResolve:p(i)},{jsy_op0:"@::",jsy_op:/@::(>?\*?)/,pre:"(()=>{",post:"})",opResolve:p(o)}],d=[{jsy_op:"::!",pre:"{(()=>{",post:"})()}",is_kw_close:!0},{jsy_op:"::!>",pre:"{(async ()=>{",post:"})()}",is_kw_close:!0},{jsy_op0:"@!*>",jsy_op:/@!\*>/,pre:"((async function *(){",post:"}).call(this))"},{jsy_op0:"@!*[]",jsy_op:/@!\*\[\]/,pre:"[... (function *(){",post:"}).call(this)]"},{jsy_op0:"@!*#",jsy_op:/@!\*#/,pre:"([... (function *(){",post:"}).call(this)])"},{jsy_op0:"@!*",jsy_op:/@!\*/,pre:"((function *(){",post:"}).call(this))"},{jsy_op0:"@!=>",jsy_op:/@!=>(>?\*?)/,pre:"((()=>",post:")())",opResolve:p(c)},{jsy_op0:"@!::",jsy_op:/@!::(>?\*?)/,pre:"((()=>{",post:"})())",opResolve:p(r)},{jsy_op0:"@!",jsy_op:/@!(>?\*?)(?!=>)/,pre:"((()=>{",post:"})())",opResolve:p(r)}],u={"":e=>({pre:`(function (${e}) {`,post:"})"}),">":e=>({pre:`(async function(${e}) {`,post:"})"}),">*":e=>({pre:`(async function * (${e}) {`,post:"})"}),"*":e=>({pre:`(function * (${e}) {`,post:"})"})},f=[{jsy_op0:"@~::",jsy_op:/@~(.*?)::(>?\*?)/,pre:"(function () {",post:"})",opResolve(e){let[t,n,s]=e.content.match(this.jsy_op),o=u[s];if(void 0===o)throw new SyntaxError(`JSY function expression unrecognized specifier ("${s}")`);return o(n||"")}}],m=(e,t=e.source,n=t)=>({prefix:t,rx_prefix:e,opPrefixResolve(e,t){let s=t.opResolve?t.opResolve(e):t,o=n+(s.pre||"");return{...s,pre:o}}}),x=[m(/;/),m(/,/),m(/\?(\.?)/,"?","?.")];function*y(e,t){let{jsy_op0:n,jsy_op:o}=e;if(/^[@?]/.test(n||o)){if(void 0===n)n=o,o=new RegExp(s(o,!1));else if("string"==typeof o)o=new RegExp(s(o,!1));else if("function"!=typeof o.exec)throw new Error("Unexpected jsy_op type");for(let s of t)yield{...e,jsy_op0:s.prefix+n,jsy_op:new RegExp(`${s.rx_prefix.source}${o.source}`,o.flags),foldTop:!0,opResolve:t=>s.opPrefixResolve(t,e)}}}function w(e,t){let n=[];for(let s of e)n.push(...y(s,t));return n.push(...e),n}const g=[{jsy_op:"::()",pre:"(",post:")",nestBreak:!0},{jsy_op:"::{}",pre:"{",post:"}",nestBreak:!0},{jsy_op:"::[]",pre:"[",post:"]",nestBreak:!0},{jsy_op:"::",pre:" {",post:"}",nestBreak:!0,is_kw_close:!0}],j=[],$=w([].concat(f,h,d,[{jsy_op:"@:",pre:"({",post:"})",implicitSep:",",isFoldable:!0},{jsy_op:"@#",pre:"([",post:"])",implicitSep:",",isFoldable:!0},{jsy_op:"@()",pre:"(",post:")",implicitSep:",",isFoldable:!0},{jsy_op:"@{}",pre:"{",post:"}",implicitSep:",",isFoldable:!0},{jsy_op:"@[]",pre:"[",post:"]",implicitSep:",",isFoldable:!0},{jsy_op:"@",pre:"(",post:")",implicitSep:",",isFoldable:!0}]).flat(),x),v={nestBreak:!0},b=[].concat(g,$,j),k=b.reduce(((e,t)=>(t.jsy_op0&&(e[t.jsy_op0]=t),"string"==typeof t.jsy_op&&(e[t.jsy_op]=t),e)),{});function S(e){return{__proto__:this,pre:e.kw+this.pre}}const E={kw_normal:{jsy_op:"kw",pre:" (",post:")",kwExpandOp:S,in_nested_block:!0},kw_explicit:{jsy_op:"kw",pre:"",post:"",kwExpandOp:S,in_nested_block:!0},tmpl_param:{jsy_op:"tmpl_param",pre:"",post:"",in_nested_block:!0},jsx_param:{jsy_op:"jsx_param",pre:"",post:"",in_nested_block:!0}},R=["if","while","for await","for","switch"],O=["catch"],F=[].concat(R.map((e=>`else ${e}`)),R,O),I=/(?:[ \t]*(?=[^\w,:;=]|$))/.source,C=new RegExp(/^(?:[ \t]*)/.source+`(?:${F.map((e=>`(?:${e=e.replace(/[ ]+/g,"[ ]+")})`)).join("|")})`+I,"g"),J=e=>s(e.jsy_op,!0),M=new RegExp(b.map(J).filter(Boolean).join("|"),"g"),T=new RegExp([{jsy_op0:"?@",jsy_op:/\?@[^\w\s]+/},{jsy_op0:";@",jsy_op:/;@[^\w\s]+/},{jsy_op0:",@",jsy_op:/,@[^\w\s]+/},{jsy_op0:"::",jsy_op:/::[^\w\s]+/},{jsy_op0:"@",jsy_op:/@[^\w\s]+/}].map(J).filter(Boolean).join("|"),"g");const z={__proto__:null,get[Symbol.toStringTag](){return"«SourceLocation»"},toString(){return`«${this.line}:${this.column}»`},get column(){return this.pos-this.line_pos},create(e,t){const n={line:0,pos:0,line_pos:0,__proto__:z};return null!=t&&(n.file=t),Object.defineProperties(n,{__root__:{value:n},source:{value:e}}),Object.freeze(n)},nextLine(){let{line:e,pos:t}=this;return e+=1,Object.freeze({line:e,pos:t,line_pos:t,__proto__:this.__root__})},move(e){if("string"==typeof e)e=e.length;else{if("number"!=typeof e)throw new TypeError("Expected move to be a string or number");e|=0}let{line:t,pos:n,line_pos:s}=this;return n+=e,Object.freeze({line:t,pos:n,line_pos:s,__proto__:this.__root__})},distance(e){return{lines:this.line-e.line,chars:this.pos-e.pos}},slice(e){if(this.source!==e.source)throw new Error("Locations from different sources");return this.source.slice(this.pos,e.pos)},syntaxError(e){const t=new SyntaxError(e);return t.src_loc=this,t}};var L=z.create;const D=/(\r\n|\r|\n)/,B=/^([ \t]*)(.*)$/,W=/^[\t]*[ ]*$/;function X(e,t){const n=t.ln_first;if(void 0===n)return!0;const s=n.len_indent;if(e.ln.len_indent-s<0)throw e.ln.indent.loc.end.syntaxError(`Invalid indent level in ${t.description}. (${e.ln.indent.loc.end})  --  current indent: ${e.ln.len_indent}  start indent: ${s} from (${n.loc.start})`);return!0}class A{constructor(e){this.disp_name=e||"root",this.by_kind={},this.by_op={}}startCompile(){return Object.defineProperties(this,{rx_list:{value:(this.rx_list||[]).slice()}}),this.by_kind=Object.assign({},this.by_kind),this.by_op=Object.assign({},this.by_op),this}addScannerList(e){for(const t of e)t&&this.addScanner(t);return this}addScanner(e){e.withDispatch&&(e=e.withDispatch(this)),e.is_body&&(this.ds_body=e),this.by_op[e.op]=e}addRegExpScanner(e,t,n){return t&&(this.by_kind[t]=e.op,this.rx_list.push(new RegExp(n,"g"))),this}finishCompile(e){return void 0===e&&(e=this.ds_body),Object.defineProperties(this,{ds_body:{value:e,writable:!0}})}clone0(){if(void 0!==this.level)throw new Error("Invalid clone0");return this.cloneWithScanner()}cloneWithScanner(...e){return this.cloneWithScannerList(e)}cloneWithScannerList(e){const t=Object.create(this);return t.level=1|t.level,t.description=t.description.replace(/\(\d+\)/,`(${t.level})`),t.startCompile(),t.addScannerList(e),t.finishCompile(),t}get_active_dispatch(e){return e[`dispatch_${this.disp_name}`]}set_active_dispatch(e){e.dispatch=e[`dispatch_${this.disp_name}`]=this}newline(e,t){}scan(e,t){const n=e.loc_tip,s=this._scan(e,t);return function(e,t){if(e.pos==t.pos)throw new Error(`Scanner failed to make progress (${t})`);if(e.pos>t.pos)throw new Error(`Scanner went backward (${t} from ${e})`)}(n,e.loc_tip),s}_scan(e,t){if(this.set_active_dispatch(e),void 0===this.ln_first){if(void 0===this.level)throw new Error("Scanner with level: undefined");this.ln_first=e.ln}X(e,this);const n=e.ln_source;let s=null,o=1/0;for(const e of this.rx_list){e.lastIndex=t;const i=e.exec(n);null!==i&&i.index<o&&(o=i.index,s=i)}if(null===s)return this.ds_body.scan(e,t);if(t!==o)return this.ds_body.scan_fragment(e,n.slice(t,o));const i=s.filter(Boolean)[1],r=this.by_kind[i],c=this.by_op[r];if(!c)throw new Error(`No scanner registered for « ${i} »`);return c.scan(e,o)}scan_fragment(e,t){throw new Error(`${this.description} does not support fragments`)}}class N extends A{clone0(){const e=super.clone0();return e.ds_body=e.ds_body.clone0(),e}scan(e,t){return e.scanner=this.ds_body,super.scan(e,t)}}class P extends A{constructor(e){super(e.disp_name),Object.assign(this,e),this._compileForInit()}_compileForInit(){this.startCompile(),this.addScannerList(this.scannerList),this.finishCompile()}}class q{constructor(e){Object.assign(this,e),this._compileForInit()}_compileForInit(){}withDispatch(e){return this}emit_ast(e,t,n){const s=e.loc_tip,o=e.loc_tip=s.move(t||0),i={type:n||this.op,loc:{start:s,end:o},content:t};return this.ast_extend(e,i),e.parts.push(i),i}ast_extend(e,t){}newline(e,t){}scan_fragment(e,t){throw new Error(`Scanner (${this.description}) does not support fragments`)}scan(e,t){throw new Error(`Scanner (${this.description}) does not support scans`)}}class Y extends q{get is_body(){return!0}scan_fragment(e,t){this.scan_content(e,t)}scan(e,t){this.scan_content(e,e.ln_source.slice(t))}scan_content(e,t){t&&this.emit_ast(e,t)}}class Z extends q{_compileForInit(){const{rx_open:e,rx_close:t}=this,n=new RegExp((e?e.source:"")+t.source),s=new RegExp("^"+t.source);Object.defineProperties(this,{rx_disp:{value:n},rx_resume:{value:s}})}withDispatch(e){return this.compileForDispatch(e),this}compileForDispatch(e){if(void 0===this.kind)return;const t=this.rx_disp.exec(this.example);if(null===t||this.kind!==t[1]||null==t[2])throw new Error(`Invalid scanner regexp and/or example (${this.description})`);e.addRegExpScanner(this,this.kind,this.rx_disp.source)}newline(e,t){if(!this.multiline&&!this.allow_blank_close)throw e.ln.loc.end.syntaxError(`Newline in ${this.description} (${e.ln.loc.end})`)}ast_extend(e,t){const n=this.ln_first||e.ln;return void 0!==n.len_inner&&(t.block_indent=n.len_inner),t}scan(e,t){const n=this.rx_disp.exec(e.ln_source.slice(t));if(null===n)throw e.loc_tip.syntaxError(`Invalid scan ${this.description}. (${e.loc_tip})`);const[s,o,i]=n,r=this.nestTrim(s,i,!1);return null!=r&&this.ast_scan_match({open:o,close:i},this.emit_ast(e,r)),this.post_scan(e,i)}scan_continue(e,t){X(e,this);const n=this.rx_resume.exec(e.ln_source.slice(t));if(null===n)throw e.loc_tip.syntaxError(`Invalid scan continue ${this.description}. (${e.loc_tip})`);const[s,o]=n,i=this.nestTrim(s,o,!0);return null!=i&&this.ast_scan_match({close:o},this.emit_ast(e,i)),this.post_scan(e,o)}ast_scan_match(e,t){}nestTrim(e,t,n){return e}post_scan(e,t){return t?(this.invert_close&&(e.scanner=this.continueScanner(e)),this.nestMatch(t,e,this.hostScanner||this)):!!this.invert_close||void(this.allow_blank_close||(e.scanner=this.continueScanner(e)))}nestMatch(e,t,n){const s=this.nesting;return void 0===s||this.nestWith(s[e],t,n)}nestWith(e,t,n){if(!0===e||null==e)return!0;if(n!==e&&"host"!==e){if("function"!=typeof e.nestedScanner)return"function"==typeof e?e(t,n):e;t.scanner=e.nestedScanner(t)}else t.scanner=n.continueScanner(t)}nestedScanner(e){return this._asNestedScanner(e,"nest",{})}continueScanner(e){return this._asNestedScanner(e,"cont",{op:this.op_continue||this.op,continueScanner(e){return this},scan(e,t){this.scan_continue(e,t)}})}_asNestedScanner(e,t,n){const s=e.scanner,o={__proto__:this,description:`${this.description} (${t})`,ln_first:e.ln_first||e.ln,_pop_scanner(e){this.op_pop&&this.emit_ast(e,"",this.op_pop),e.scanner=s},scan(e,t){!0===super.scan(e,t)&&this._pop_scanner(e)},scan_continue(e,t){!0===super.scan_continue(e,t)&&this._pop_scanner(e)}};return Object.assign(o,n)}}class U extends Z{newline(e,t){}get multiline(){return!0}ast_extend(e,t){let n=t.loc.start.column,s=this.mlctx??={col:n};return n<s.col&&(s.col=n),t.mlctx=s,t}}class H extends Z{withTag(e,t,n){const s=this.rx_replace||/tag/g,o=this.rx_open.source.replace(s,t),i=this.rx_close.source.replace(s,t),r=new RegExp(o),c=new RegExp(i),p=new RegExp(o+c.source),l={__proto__:this,hostScanner:n,rx_open:r,rx_close:c,rx_resume:new RegExp("^"+i),rx_disp:p,tag:t,ln_first:e.ln,compileForDispatch(e){e.addRegExpScanner(this,this.kind,this.rx_disp.source)}};return l.tagScanner(e,t,n),l}tagScanner(e,t,n){}}class G extends U{scan(e,t){const n=this.rx_disp.exec(e.ln_source.slice(t));return this.withLeaderTag(e,n[2])._leader.scan(e,t)}withLeaderTag(e,t){const n={__proto__:this,__root__:this.__root__||this,ln_first:e.ln};return n._trailer=this.trailer&&this.trailer.withTag(e,t,n),n._leader=this.leader.withTag(e,t,n),n}}function K(e){if(!Object.isFrozen(e)||!Array.isArray(e))throw new TypeError("Expected a frozen array of context scanners");const t=K.cache||new WeakMap;t!==K.cache&&(K.cache=t);let n=t.get(e);return void 0===n&&(n=function(e){const t=o();return n;function n(e){const n={scanner:t.clone0()};for(const t of e)if(t.is_blank)delete t.content,n.scanner.newline(n,!0);else{if(n.parts=[],n.ln=t,s(n,t.content),0===n.parts.length)throw new Error("No parts generated by context scanner");t.content=n.parts,n.scanner.newline(n,!1)}return n.scanner.newline(n,!0),e}function s(e,t){const n=e.ln_source=t.content,s=(e.loc_tip=e.loc_start=t.loc.start).pos;for(;;){const t=e.loc_tip.pos-s;if(t>=n.length)return;e.scanner.scan(e,t)}}function o(){const t=(new A).startCompile();t.description="JSY Dispatch scanner (0)";const n=(new N).startCompile();n.description="Firstline JSY Dispatch scanner (0)";for(const s of e){if(!s)continue;(s.firstline?n:t).addScanner(s)}return t.finishCompile(),n.finishCompile(t)}}(e),t.set(e,n)),n}function Q(e,t,n,s){return K(n)(function(e,t){null==t&&(t={warn(e,...t){console.warn(`[Offside Warning]:: ${e}`,...t)}});const n=[],s=e.split(D),o={__proto__:null,get source(){const{start:e,end:t}=this.loc;return e.slice(t)}};let i=L(e,t.file);for(;0!==s.length;){const e={start:i=i.nextLine()},t=s.shift()||"";e.end=i=i.move(t);const r=s.shift()||"";i=i.move(r);const c=B.exec(t),p=e.start.move(c[1]),l=0===c[2].length;if(!W.test(c[1]))throw e.start.syntaxError(`Mixed tab and space indent (${p})`);const a={line:t,line_end:r,indent:c[1],content:c[2]};let _;_=l?{type:"offside_blank_line",loc:e,is_blank:l}:{__proto__:o,type:"offside_line",loc:e,indent:{type:"offside_indent",loc:{start:e.start,end:p},len_indent:c[1].length,indent:c[1]},content:{type:"offside_content",loc:{start:p,end:e.end},len_indent:c[1].length,indent:c[1],content:c[2]},len_indent:c[1].length},Object.defineProperties(_,{raw:{value:a}}),n.push(_)}return function(e){let t=0,n=[0];for(let s=e.length-1;s>=0;s--){let o=e[s];if(o.is_blank)continue;o.len_dedent=t;let i,r=o.len_indent;for(;n[0]>r;)i=n.shift();n[0]<r&&n.unshift(r),i&&(o.len_inner=i),t=r}}(n),n}(e,t))}const V=new Y({description:"Source Code Scanner",op:"src"}),ee=new class extends Y{constructor(e){if(super(e),!this.char_pairs)throw new Error("Missing required char_pairs mapping");const t=Object.keys(this.char_pairs).join("\\");this.rx=new RegExp(`([${t}])`)}withOuter(e){const t=e.scanner;if("function"!=typeof t.scan)throw new Error("Expected valid outer scanner");delete e.scanner;const n=Object.create(this,{restore_scanner:{value:t}});return Object.assign(n,e),n}scan_content(e,t){const{stack:n,char_pairs:s}=this;let o="";for(const i of t.split(this.rx)){const t=1===i.length?s[i]:void 0;if(void 0===t){o+=i;continue}if(!0===t){o+=i,n.push(i);continue}if(n.pop()!==t){const t=e.loc_tip.move(o);throw t.syntaxError(`Mismatched nesting in ${this.description} (${t})`)}if(0===n.length)return o&&this.emit_ast(e,o),this.emit_ast(e,i,this.ast_end||"nested_end"),void(e.scanner=this.restore_scanner);o+=i}o&&this.emit_ast(e,o)}}({op:"src",description:"Template parameter source",char_pairs:{"{":!0,"}":"{","(":!0,")":"(","[":!0,"]":"["}}),te=new Z({description:"Hashbang directive",example:"#!/usr/bin/env node",op:"hashbang",kind:"#!",rx_open:/^(#!)/,rx_close:/.*($)/,firstline:!0,allow_blank_close:!0}),ne=new Z({description:"Comment to end of line",example:"// comment",op:"comment_eol",kind:"//",rx_open:/(\/\/)/,rx_close:/.*($)/,allow_blank_close:!0}),se=new U({description:"Multi-line comment",example:"/* comment */",op:"comment_multi",kind:"/*",rx_open:/(\/\*)/,rx_close:/.*?(\*\/|$)/}),oe=new Z({description:"Single quote string literal",example:"'single quote'",op:"str1",kind:"'",rx_open:/(')/,rx_close:/(?:\\.|[^'])*('|$)/}),ie=new Z({description:"Double quote string literal",example:'"double quote"',op:"str2",kind:'"',rx_open:/(")/,rx_close:/(?:\\.|[^"])*("|$)/}),re=new Z({description:"Preprocessor directive",example:'# IF platform === "web"',op:"preprocessor",kind:"#",rx_open:/^\s*(#)/,rx_close:/.*?([\\]?)\s*$/,invert_close:!0,allow_blank_close:!0}),ce=Object.freeze([V,te,ne,se,oe,ie,re]),pe=new Z({description:"RegExp literal",example:"/regexp/",op:"regexp",kind:"/",rx_open:new RegExp(/(\/)(?![\/\*])/.source+/(?:\\.|[^\\\/\[]|\[(?:\\.|[^\]])*\])+/.source),rx_close:/(\/[a-z]*)\s*(?=[;.,)\]}]|$)/}),le=new U({description:"Template quote string literal",example:"`template string`",op:"str_template",kind:"`",rx_open:/(`)\\?/,rx_close:/(?:\\.|\$(?!{)|[^\$`\\])*(`|\${|$)/,nesting:{"${":function(e,t){const n=ee.withOuter({scanner:t.continueScanner(e),stack:["{"],ast_end:"template_param_end"});n.emit_ast(e,"","template_param"),e.scanner=e.dispatch_root.cloneWithScanner(n)}},ast_scan_match(e,t){"`"==e.open&&(t.tmpl_opened=!0),"`"==e.close&&(t.tmpl_closed=!0)}});const ae=Object.freeze([pe,le,...ce]),_e=new Y({description:"JSX Content Scanner",op:"jsx_content"}),he=new Z({description:"JSX Content Expression",example:"{ param }",op:"jsx_content_expr",kind:"{",rx_open:/\s*({)/,rx_close:/()/,nestTrim(e,t,n){},post_scan(e){we(e,null)}}),de=new Z({description:"JSX attribute name value",op:"jsx_attr_name",rx_open:/\s*([a-zA-Z0-9_:.\-]+)/,rx_close:/\s*(=)\s*/}),ue=new Z({description:"JSX attribute name only",op:"jsx_attr_name_only",rx_open:/\s*([a-zA-Z0-9_:.\-]+)/,rx_close:/()/,post_scan(e,t){return this.nestMatch(t,e,this.hostScanner||this)}}),fe=new Z({description:"JSX Single quote attribute literal",multiline:!0,op:"jsx_attr_str1",rx_open:/\s*(')/,rx_close:/(?:\\.|[^'])*(')\s*/}),me=new Z({description:"JSX Double quote attribute literal",multiline:!0,op:"jsx_attr_str2",rx_open:/\s*(")/,rx_close:/(?:\\.|[^"])*(")\s*/}),xe=new H({description:"JSX Close Tag",example:"</tag>",op:"jsx_tag_close",kind:"</",multiline:!0,rx_open:/(<\/)\s*/,rx_close:/([a-zA-Z0-9_:.\-]+)\s*>/,tagScanner(e){this.restore_scanner=e.scanner},post_scan(e,t){if(t!==this.tag)throw e.loc_tip.syntaxError(`Mismatched JSX close tag "</${t}>", expected "</${this.tag}>". (${e.loc_tip})`);e.scanner=this.restore_scanner}}),ye=new H({description:"JSX Tag",multiline:!0,op:"jsx_tag",op_continue:"jsx_tag_part",rx_open:/(<)tag\b\s*/,rx_close:/\s*?($|\/>|[{'">]|[a-zA-Z0-9_:.\-]+=?)/,nesting:{">":"host","/>":!0},nestingEnd:{"{":we,"=":de,"'":fe,'"':me},nestTrim(e,t,n){return this.nesting[t]||(e=e.slice(0,-t.length)),e||null},nestMatch(e,t,n){let s=this.nesting[e];return void 0===s&&(s=this.nestingEnd[e.slice(-1)]||ue),!0!==s&&"host"!==s&&(t.scanner=n=this.continueScanner(t)),this.nestWith(s,t,n)}});function we(e,t){const n=ee.withOuter({scanner:null!==t?t.continueScanner(e):e.scanner,stack:["{"],ast_end:"jsx_param_end"});n.emit_ast(e,"{","jsx_param"),e.scanner=e.dispatch_root.cloneWithScanner(n)}const ge=new class extends G{continueScanner(e){X(e,this);const t=this.ds_body.cloneWithScanner(this._trailer);return t.ln_first=t.disp_name===e.dispatch.disp_name?e.dispatch.ln_first:this.ln_first||e.ln,t}andDispatchWith(e){e.scannerList=[...e.scannerList,this];const t=new P(e);return this.ds_body=t,t}}({description:"Embedded JSX expression",example:"<section>content</section>",kind:"<",disp_name:"jsx",op:"jsx",rx_open:/(<)([a-zA-Z0-9_:.\-]+)(?=\s*?(?:$|\/>|>|\s{|\s[a-zA-Z0-9_:\-]+=?))/,rx_close:/.*$/,leader:ye,trailer:xe}),je=ge.andDispatchWith({description:"JSX Dispatch Scanner (0)",disp_name:"jsx",scannerList:[_e,he]}),$e=new Z({description:"Embedded JSX fragment close expression",example:"</>",op:"jsx_frag_close",kind:"</",allow_blank_close:!0,rx_open:/(<\/)\s*/,rx_close:/([a-zA-Z0-9_:.\-]*)\s*>/,post_scan(e,t){if(t)throw e.loc_tip.syntaxError(`Mismatched JSX fragment close tag "</${t}>", expected "</$>". (${e.loc_tip})`);e.scanner=this.restore_scanner}}),ve=new Z({description:"Embedded JSX fragment expression",example:"<></>",op:"jsx_frag",kind:"<>",rx_open:/(<>)/,rx_close:/.*($|<\/>)/,nestTrim:(e,t,n)=>"<>",post_scan(e){const t={__proto__:$e,restore_scanner:e.scanner},n=je.cloneWithScanner(t);n.description="Fragment"+n.description;const s=n.get_active_dispatch(e);n.ln_first=s&&s.ln_first||e.ln,e.scanner=n}}),be=Object.freeze([ve,ge,...ae]);const ke=e=>"offside_dedent"===e.type;function Se(e,t){const n=function(e,t){return Q(e,t,be)}(e,t);!function(e,t){if("function"!=typeof t){const e=new Set(t||["comment_eol"]);t=t=>e.has(t)}for(const n of e){if(n.is_blank)continue;const{len_dedent:e,len_indent:s,len_inner:o}=n,i={type:"offside_dedent",len_dedent:e,len_indent:s};o&&(i.len_inner=o);const r=n.content.pop();r.multiline||t(r.type)?n.content.push(i,r):n.content.push(r,i)}}(n,["comment_eol"]);for(let e of n){if(e.is_blank)continue;let t=e.content=Ee(e.content,e),n=t.findIndex(ke),s=t[n--];for(;n>=0;){let e=t[n--];if(void 0!==e)if(/^jsy_op/.test(e.type))s.ends_with_jsy_op=!0,e.ending_jsy_op=!0;else if("src"!==e.type||e.content.trim())break}}return n}function Ee(e,t){const n=[];for(let s,o=0;void 0!==(s=e[o]);o++)"src"===s.type?Oe(n,s,t):n.push(s);let s="src"===n[0].type;for(let e=0;void 0!==n[e];e++)s?(Re(n,e,t),s=!1):"jsy_op"===n[e].type&&(s="::"===n[e].op);return n}function Re(e,t,n){const s=e[t];C.lastIndex=0;const o=C.exec(s.content);if(!o)return!1;const i=o.input.slice(C.lastIndex);if("("===i[0])return e;const r=s.loc.start,c=r.move(o[0]),p=o[0].split(" ").filter(Boolean).join(" "),l=i?null:e[1+t],a=l&&"jsy_op"===l.type&&"@"===l.op,_={type:"jsy_kw",kw:p,loc:{start:r,end:c},len_indent:n.len_indent,explicit:a},h=Fe(i,c,s.loc.end);return e.splice(t,1,_,h),!0}function Oe(e,t,n){{M.lastIndex=0;let s=t.loc.start;for(;;){let r=s,c=M.lastIndex;const p=M.exec(t.content);if(!p)return i(s,c),e;c<p.index&&(r=s=o(s,c,p.index),c=M.lastIndex);const l=p[0].trim(),a={type:"jsy_op",op:l,loc:{start:r,end:s=s.move(p[0])},len_indent:n.len_indent,content:p[0]},_=p.slice(1).filter(Boolean);_.length&&(a.type="jsy_op_args",a.op_args=_,a.op=_.reduce(((e,t)=>e.replace(t,"")),l)),e.push(a)}}function s(t,s,o){T.lastIndex=o;const i=T.exec(t);if(i){const t=i[0].trim(),o=s,r=s=s.move(i[0]);e.push({type:"jsy_unknown",op:t,loc:{start:o,end:r},len_indent:n.len_indent,content:i[0]})}}function o(n,o,i){const r=t.content.slice(o,i);s(r,n,o);const c=n,p=n.move(r);return e.push(Fe(r,c,p)),p}function i(n,o){const i=t.content.slice(o);if(i){s(i,n,o);const t=n,r=t.move(i);e.push(Fe(i,t,r))}}}function Fe(e,t,n){return{type:"src",loc:{start:t,end:n},content:e}}const Ie=Symbol("#IF?"),Ce={bind(){const e=/^#\s*([A-Z]+\b)(.*)$/;return(t,n)=>{let[,s,o]=e.exec(t.content)||[];if(!this["v$"+s])throw this.syntaxError(t);return this["v$"+s](t,(o||"").trim(),n)}},syntaxError:e=>e.loc.start.syntaxError(`Preprocessor Invalid: "${e.content}"`),v$IF(e,t,n){if(!t)throw this.syntaxError(e);let s=!!this.answerFor(t);return n[Ie]=s},v$ELIF(e,t,n){if(!t||"boolean"!=typeof n[Ie])throw this.syntaxError(e);if(!n[Ie]){let e=!!this.answerFor(t);return n[Ie]=e}return!1},v$ELSE(e,t,n){if(t||"boolean"!=typeof n[Ie])throw this.syntaxError(e);return!n[Ie]&&(n[Ie]=null,!0)}};function Je(e){if(null!=e){if("object"==typeof e)e=function(e){{let n=(e,t)=>(t.order=e,t),s=e=>!e,o=(e,t)=>e&&t,i=(e,t)=>e||t,r={__proto__:null,false:!1,FALSE:!1,true:!0,TRUE:!0,NOT:s,"!":n(0,s),AND:o,"&&":n(10,o),OR:i,"||":n(20,i)};var t=t=>r[t]??e[t]}function n(e,t){t.push(e.length?e(...t.splice(-e.length)):e())}return function(e){let s=[],o=[],i=e.split(/\s+/).map(t);for(let e of i)if("function"==typeof e){for(;o[0]&&(0|o[0].order)<=(0|e.order);)n(o.shift(),s);o.unshift(e)}else s.push(e);for(;o[0];)n(o.shift(),s);if(1!==s.length)throw new SyntaxError(`Invalid preprocessor expression: "${e}"`);return s[0]}}(e);else if("function"!=typeof e)throw new TypeError("Expected a function or object for basic_preprocessor");return{__proto__:Ce,answerFor:e}.bind()}}const Me={__proto__:null,*ast_iter(e){let t,n=this.start();for(t of e)t=t.is_blank?this.blank_line(t):this.ast_line(t,n),null!=t&&(yield t);t=this.finish(n),null!=t&&(yield t)},start:()=>({tip:{}}),finish(e){},blank_line:e=>e,indent_state(e,t){let n=t.tip;for(;e.len_indent<(0|n.len);)n=n.tail;return t.tip=n},_dbg_ln:e=>e.indent.indent+e.content.map((e=>e.content||"")).join(""),ast_line(e,t){if("exclude"===this.indent_state(e,t).op)return this.exclude_line(e,t),e;for(let n of e.content)this[`v$${n.type}`]?.(n,e,t);return e},preprocess(e,t){},v$preprocessor(e,t,n){let s=n.tip,o=e.ans=this.preprocess(e,s);!1===o?(e.type+="_exc",n.tip={op:"exclude",len:t.len_inner,tail:s}):!0===o?(e.type+="_inc",n.tip={len:t.len_inner,tail:s}):"string"==typeof o&&(e.type+="_sz")},exclude_line(e,t){let n=[{type:"exclude_line",content:"//~ "}];for(let t of e.content)"offside_dedent"===t.type?n.unshift(t):(t.type="exclude_part",n.push(t));return e.content=n,e}},Te=/[,.;:?]/,ze=/\&\&|\|\||\?\?/,Le=qe("",[Te,/=>/,/(?<![+-])[+-]/,ze],"\\s*$"),De=qe("^\\s*",[Te,ze],""),Be=qe("^\\s*",[/\.\.\./],""),We=/[()\[\]{}]|<\/?\w*>/,Xe=/\s+as\s+\w+/g;function Ae(e,t,n){let s=t.split(We).pop();if(Le.test(s))return!1;let o=n.split(We).shift();return!(De.test(o)&&!Be.test(o))&&(e.pre.includes("{")&&(t=t.replace(Xe,""),n=n.replace(Xe,"")),!!Pe(`${e.pre} ${t} , post_body ${e.post}`)||!!Pe(`${e.pre} pre_body , ${n} ${e.post}`))}const Ne=[function(){}.constructor,function*(){}.constructor,async function(){}.constructor,async function*(){}.constructor];function Pe(e){for(let t of Ne)try{return new t(`return ${e}`),!0}catch(e){}return!1}function qe(e,t,n){return t=[...t].flatMap((e=>e?[e.source]:[])),new RegExp(`${e}(?:${t.join("|")})${n}`)}const Ye=/^[ \t]+/,Ze=Object.freeze({__proto__:null}),Ue={__proto__:null,*ast_iter(e){let t,n;for(t of(this.start(),e))n=this.ast_line(t),yield`${n?.join("")??n??""}\n`;n=this.finish(),yield`${n?.join("")??n??""}\n`},ast_line(e){if(e.is_blank)return this.blank_line(e);this.start_line(e),this.v$offside_indent(e.indent);let t=e.indent;for(let n of e.content){let s=`v$${n.type}`;if(void 0===this[s])throw new Error(`JSY transpile function "${s}" not found`);this[s](n,e,t),t=n}return this.finish_line(e)},start(){this.lineno=0,this.head=Ze},finish(){if(Ze!==this.head)throw new Error("Excess stack at finish")},blank_line(e){this.lineno++},start_line(e){this.lineno++,this.cur_ln=e,(this._cur=[]).finish_ops=[]},finish_line(e){let t=this._cur;for(let n of t.finish_ops||[])t=n(t,e);let n=this.head.comma_body;return void 0!==n&&n.push("\n"),t},emit_raw(e){e&&this._cur.push(e)},emit(e,t){if(t&&this.addSourceMapping){const e=this._cur.join("").length;this.addSourceMapping({generated:{line:this.lineno,column:e},original:{line:t.line,column:t.column}})}const n=this.head.comma_body;void 0!==n&&n.push(e),this._cur.push(e)},emit_indent(e){const t=this._cur;if(0!==t.length)throw new Error("Indent must be first element of cur list");const n=this.head.comma_body;if(void 0===n)return void t.push(e);if(n.splice(0,n.length,n.join("").trimLeft()),n.len_inner!=this.cur_ln.len_indent)return void t.push(e);t.push(e||" ");t.finish_ops.push((e=>{const t=n[0];if(!t)return e;const s=n.slice(1).join("");return this.checkOptionalComma(n.op,t,s)&&(e[0].length>1?e[0]=e[0].replace(/\s\s$/,", "):e[0]=",",n.shift()),e}))},_checkOptionalComma:Ae,checkOptionalComma:Ae,stack_push(e,t){if(e.foldTop&&this.head.isFoldable&&this.stack_pop(),null===e.post)return void(e.pre&&this.emit(e.pre));const{len_indent:n,loc:s}=t,o={__proto__:this.head,op:e,len_indent:n,loc:s,isFoldable:e.isFoldable,nestBreak:e.nestBreak};if(","==e.implicitSep){const t=o.comma_body=[];t.op=e,t.len_inner=this.cur_ln.len_inner}else o.comma_body=void 0;e.in_nested_block&&(o.in_nested_block=!0,o.nested_block_indent=n),o.tail=[this.head].concat(o.tail||[]);let i=o.op.pre;i&&this.emit(i),this.head=o},stack_pop(e){let t=this.head,n=t.tail[0];if(this.head=n,n.comma_body){let e=t.op.substitute??(","==t.op.implicitSep||/[\)\]]\s*$/.test(t.op.post)?"expr":null);null!=e&&n.comma_body.push(` ${e} `)}let s=t.op.post;s&&this.emit(e?" "+s:s)},v$jsy_unknown(e){throw e.loc.start.syntaxError(`JSY unknown operator "${e.op}"`)},v$jsy_kw(e){const t=e.explicit?E.kw_explicit:E.kw_normal;this.stack_push(t.kwExpandOp(e),e)},v$jsy_op(e){this._jsy_op(k[e.op],e)},v$jsy_op_args(e){this._jsy_op(k[e.op],e)},_jsy_op(e,t){if(!e)throw new Error(`JSY op handler not found for "${t.op}"`);e.warn&&e.warn(t),e.opResolve&&(e=function(e){let{pre:t,post:n}=e;if(null!==t&&"string"!=typeof t)throw new Error("Invalid resolved jsy_op_item.pre result");if(null!==n&&"string"!=typeof n)throw new Error("Invalid resolved jsy_op_item.post result");return e}(e.opResolve(t))).warn&&e.warn(t),this._jsy_op_exec(e,t)},_jsy_op_exec(e,t){e.is_kw_close&&this._dedent_nested_block(t),this.stack_push(e,t)},_dedent_nested_block(e){if(!this.head.in_nested_block)return;null!=e&&(e.len_indent=this.head.nested_block_indent);let t=0,n=!1;for(;this.head&&this.head.in_nested_block&&!n;)n=this.head.op.in_nested_block,this.stack_pop(t++)},_dedent_multi_ops(){if(!this.head.loc)return;const e=this.cur_ln.loc.start.line,t=this.head.tail.filter((t=>t.loc&&e===t.loc.start.line)).pop();if(void 0===t)return;let n=0;for(;t!==this.head&&!this.head.nestBreak;)this.stack_pop(n++)},v$offside_dedent(e){e.ends_with_jsy_op||this._dedent_multi_ops();let t=0;for(;this.head.len_indent>=e.len_dedent;)this.stack_pop(t++)},v$offside_indent(e){this.emit_indent(e.indent)},v$template_param(e){this._param(E.tmpl_param,e)},v$template_param_end(e){this._param_end(e)},v$jsx_param(e){this._param(E.jsx_param,e)},v$jsx_param_end(e){this._param_end(e)},_param(e,t){this.stack_push(e,t),this.emit_raw(t.content)},_param_end(e){this._dedent_nested_block(e),this.emit_raw(e.content);let t=this.head.comma_body;void 0!==t&&t.push("null }")},v$str_template(e,t,n){if(e.tmpl_opened&&this.stack_push(v,e),n===t.indent&&e.mlctx){let t=this._cur.pop();this._cur.push(t.slice(e.mlctx.col))}if(this.emit(e.content,e.loc.start),e.tmpl_closed){this.stack_pop();let e=this.head.comma_body;void 0!==e&&e.push("`tmpl_expr`")}},v$src(e,t,n){let s=e.content;({jsy_op:1,jsy_kw:1})[n.type]&&Ye.test(s)&&(s=s.replace(Ye,"")),this.emit(s,e.loc.start)},v$preprocessor(e,t){this.emit(e.content)},v$preprocessor_sz(e,t){this.emit(e.ans)},v$preprocessor_inc(e,t){this.inc_preprocessor&&this.emit(`//+~${e.content}`)},v$preprocessor_exc(e,t){this.inc_preprocessor&&this.emit(`//-~${e.content}`)},v$exclude_line(e,t){this.inc_preprocessor&&this.emit(e.content)},v$exclude_part(e,t){this.inc_preprocessor&&this.emit(e.content)},v$str:Ge,v$str1:Ge,v$str2:Ge,v$regexp:Ge,v$jsx_frag:Ge,v$jsx_frag_close:Ge,v$jsx_tag:Ge,v$jsx_tag_part:Ge,v$jsx_tag_close:Ge,v$jsx_attr_name:Ge,v$jsx_attr_name_only:Ge,v$jsx_attr_str1:Ge,v$jsx_attr_str2:Ge,v$jsx_content:Ge,v$jsx_content_expr:Ge,v$hashbang:He,v$comment_eol:He,v$comment_multi:He};function He(e){this.emit_raw(e.content)}function Ge(e){this.emit(e.content,e.loc.start)}const Ke="0.10.6";function Qe(e,t){return[...Ve(e,t)].join("").replace(/\s+$/,"\n")}function*Ve(e,t){t||(t={}),"string"==typeof e&&(e=Se(e,t));let n=t.preprocessor?.()??Je(t.defines);if(n){e={__proto__:Me,...t.preprocess_visitor,preprocess:n}.ast_iter(e)}{let n={__proto__:Ue,...t.visitor};t.checkOptionalComma&&(n.checkOptionalComma=t.checkOptionalComma),t.addSourceMapping&&(n.addSourceMapping=t.addSourceMapping),yield*n.ast_iter(e)}{let e=t.inlineSourceMap?.();e&&(yield function(e,t="\n"){return"string"!=typeof e&&(e=JSON.stringify(e)),`${t}//# sourceMappingURL=data:application/json;charset=utf-8;base64,${"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):globalThis.btoa(unescape(encodeURIComponent(e)))}${t}`}(e,"\n"))}}function et(e){e={version:3,...e||{}};const t=[],n=[],s=[],o=new Map;return{toJSON:i,toString:()=>JSON.stringify(i()),setSourceContent(e,t){null!=t?o.set(`${e}`,t):o.delete(`${e}`)},addMapping({generated:e,original:o,source:i,name:r}){const c={gl:e.line,gc:e.column,ol:null!=o&&o.line,oc:null!=o&&o.column};null!=i&&(c.source=i=`${i}`,t.includes(i)||t.push(i)),null!=r&&(c.name=r=`${r}`,n.includes(r)||n.push(r)),s.push(c)}};function i(){const i={...e,sources:[...t],names:[...n]};return i.mappings=function(e,t){const n=tt(0),s=tt(0),o=tt(0),i=tt(0),r=tt(0);let c,p=1,l="";for(const a of e){let e="";if(a.gl!==p)for(n(0);a.gl!==p;)e+=";",p++;else if(void 0!==c){if(0===st(a,c))continue;e+=","}e+=n(a.gc),null!=a.source&&(e+=r(t.sources.indexOf(a.source)),e+=o(a.ol-1),e+=s(a.oc),null!=a.name&&(e+=i(t.names.indexOf(a.name)))),l+=e,c=a}return l}(s,i),0!==o.size&&(i.sourcesContent=i.sources.map((e=>o.get(e)||null))),i}}function tt(e){const t=n=>{const s=function(e){e=e>=0?e<<1:1|-e<<1;let t="";for(;;){let n=31&e;if(0===(e>>>=5))return t+=ot[n],t;t+=it[n]}}(n-e);return t.value=e=n,s};return t.value=e,t}const nt=(e,t)=>e==t?0:null==e?1:null==t?-1:e>t?1:-1,st=(e,t)=>e.gl-t.gl||e.gc-t.gc||nt(e.source,t.source)||e.ol-t.ol||e.oc-t.oc||nt(e.name,t.name),ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef",it="ghijklmnopqrstuvwxyz0123456789+/";const rt={i:1,ts:Date.now().toString(36)};function ct(e,...t){let n=null==t[0]||"object"!=typeof t[0]?t.shift():null,s=t.pop()||{};null==n&&(n=`<jsy-${rt.i++}-${rt.ts}>.jsy`);const o=s.sourcemap?s.create_sourcemap?s.create_sourcemap():et():null;null!==o&&o.setSourceContent(n,e);let i=Qe(e,{addSourceMapping(e){null!=o&&(n&&(e.source=n),o.addMapping(e))},inlineSourceMap(){if(o&&"inline"==s.sourcemap)return o.toString()},...s});return s.as_rec?{code:i,srcmap:o}:i}export{ct as default,Qe as jsy_transpile,ct as jsy_transpile_srcmap,Ke as version};
